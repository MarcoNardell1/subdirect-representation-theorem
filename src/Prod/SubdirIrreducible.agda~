open import Overture using ( ğ“ ; ğ“¥ ; Signature ; âˆ£_âˆ£)

module Prod.SubdirIrreducible {ğ‘† : Signature ğ“ ğ“¥} where
open import Agda.Builtin.Equality using (_â‰¡_)
open import Level
open import Data.Product
open import Relation.Binary using (Setoid) renaming (Rel to BinRel)
open import Function using (_âˆ˜_ ; Func)
open import Function.Construct.Composition using (function)

open import Base.Relations using (0[_])
open import Setoid.Algebras  {ğ‘† = ğ‘†}
open import Setoid.Subalgebras.Subalgebras {ğ‘† = ğ‘†} 
open import Setoid.Functions using (IsSurjective ; IsBijective ; BijInv)
open import Setoid.Homomorphisms {ğ‘† = ğ‘†} hiding (_â‰…_ ; mkiso)
open import Setoid.Homomorphisms.Isomorphisms {ğ‘† = ğ‘†}

open import Prod.Subdirect
open import Prod.ImageProperties 
open import Prod.Subembedding
-- open import Prod.NatMapProps

private variable Î± Î² Ïáµ… Ïáµ i : Level

-- Defining Isomorphisms as a bijective homomorphism
module _ (ğ€ : Algebra Î± Ïáµ…) (ğ : Algebra Î² Ïáµ) where
  open Algebra ğ€ renaming (Domain to A)
  open Algebra ğ renaming (Domain to B)

  record IsIso (h : Func A B) : Set (ov((Î± âŠ” Ïáµ… âŠ” Î² âŠ” Ïáµ âŠ” Ïáµ))) where
    field
      Hom : IsHom ğ€ ğ h
      IsBij : IsBijective h
      
  Iso : Set ((ov((Î± âŠ” Ïáµ… âŠ” Î² âŠ” Ïáµ âŠ” Ïáµ)))) 
  Iso = Î£ (Func A B) IsIso
{-
  Isoâ†’â‰… : (h : Iso) â†’ ğ€ â‰… ğ
  Isoâ†’â‰… h = mkiso homâ†’ â†hom (Î» b â†’ {!!}) {!!}
    where
      open IsIso (projâ‚‚ h)
      open IsHom Hom
      open Setoid A renaming (refl to refla; _â‰ˆ_ to _â‰ˆâ‚_)
      open Setoid B renaming (refl to reflb; _â‰ˆ_ to _â‰ˆb_)

      hâ»Â¹ : Func B A
      hâ»Â¹ = BijInv (projâ‚ h) IsBij
 
      homâ†’ : hom ğ€ ğ
      homâ†’ = (projâ‚ h) , Hom

      â†hom : hom ğ ğ€
      â†hom = hâ»Â¹ , record { compatible = Î» {f} {a} â†’ {!!} } 
     
      eqb : âˆ€ (a : ğ•Œ[ ğ€ ]) â†’ <$> hâ»Â¹ (<$> (projâ‚ h) a) â‰ˆâ‚ a
      eqb a = {!!}
-}

{-
IsIso : (Hom A B) â†’ Set
IsIso h = Î£[ i âˆˆ Iso A B ] (ext-eq h (from i))
  where ext-eq : (f g : Hom A B) â†’ Set
        ext-eq f g = (âˆ€ a : D[ A ]) â†’ f a â‰ˆ g a
-}
-- Definition of subdirectly irreducible
{-
  A nontrivial algebra ğ€ is called subdirectly irreducible
  if for every subdirect embedding h : ğ€ â†’ â¨…_{iâˆˆ I} ğ€áµ¢,
  there is a j âˆˆ I such that pâ±¼ âˆ˜ h : ğ€ â†’ ğ€â±¼ is an isomorphism. 
-}

IsSubIrreducible : âˆ€ {I : Set i} (ğ€ : Algebra Î± Ïáµ…) (ğ“ : I â†’ Algebra Î± Ïáµ…)
                 â†’ âˆ€ (h : SubdirectEmbedding ğ€ ğ“)
                 â†’ Set (i âŠ” (ov (Î± âŠ” Ïáµ…)))
IsSubIrreducible {I = I} ğ€ ğ“ h = Î£[ j âˆˆ I ] IsIso ğ€ (ğ“ j) (function (projâ‚ h) (â¨…-fun ğ“ j))   

record SubdirectlyIrreducible : Set (ov (i âŠ” Î± âŠ” Ïáµ…)) where
  field
    ix : Set i
    base : Algebra Î± Ïáµ…
    family : ix â†’ Algebra Î± Ïáµ…
    subEmbs : SubdirectEmbedding base family
    isSubIrr : IsSubIrreducible base family subEmbs
